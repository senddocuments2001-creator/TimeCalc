<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Project Creation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      border-color: #667eea;
    }
    .header-input {
      width: 100%;
      border: 1px solid #e2e8f0;
      border-radius: 0.375rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      background: #f8fafc;
    }
    .header-label {
      font-size: 0.65rem;
      font-weight: 700;
      color: #4a5568;
      text-transform: uppercase;
      margin-bottom: 0.1rem;
      display: block;
    }
    /* Fixed width for Layer column to prevent jumping */
    .col-layer {
      width: 80px;
      min-width: 80px;
    }
    .col-tp {
      width: 120px;
      min-width: 120px;
    }
  </style>
</head>

<body class="p-2 font-sans">

<div class="max-w-7xl mx-auto space-y-3">

  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-xl font-bold text-white mb-0.5">Project Creation</h1>
      <p class="text-indigo-100 text-xs">Manage issues, metrics, and production details</p>
    </div>
    <div class="flex gap-2">
       <button onclick="addIssue()" class="px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs font-bold shadow-lg transition-all flex items-center gap-1">
         <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"></path></svg>
         Add Issue
       </button>
       <span class="px-2 py-0.5 bg-white/20 text-white rounded-full text-xs font-medium backdrop-blur-md flex items-center">classmate</span>
    </div>
  </div>

  <div class="glass-effect rounded-lg p-3 shadow-xl">
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
      <div><label class="header-label">Fabric Party Name</label><input type="text" class="header-input" placeholder="Name"></div>
      <div><label class="header-label">Challan Number</label><input type="text" class="header-input" placeholder="CH-001"></div>
      <div><label class="header-label">Lot Number</label><input type="text" class="header-input" placeholder="LOT-2024"></div>
      <div><label class="header-label">Dealer Name</label><input type="text" class="header-input" placeholder="Dealer X"></div>
      <div><label class="header-label">Cutting Date</label><input type="date" class="header-input"></div>
      <div><label class="header-label">Fabric Received Date</label><input type="date" class="header-input"></div>
    </div>
  </div>

  <div class="grid grid-cols-3 gap-3">

    <div class="col-span-2 glass-effect rounded-lg p-3 shadow-xl">
      <h2 class="text-sm font-bold text-gray-800 mb-2 flex items-center gap-1">
        <svg class="w-4 h-4 text-indigo-600" fill="currentColor" viewBox="0 0 20 20"><path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4z"/></svg>
        Issues & Metrics
      </h2>
      
      <div class="mb-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-2">
        <p class="text-xs font-semibold text-gray-700 mb-2">Size Configuration (Quantity per Size)</p>
        <div class="grid grid-cols-9 gap-2" id="sizeInputs"></div>
      </div>
      
      <div class="overflow-x-auto rounded-lg border border-gray-200">
        <table class="w-full text-xs table-fixed">
          <thead class="bg-gradient-to-r from-indigo-50 to-purple-50">
            <tr>
              <th class="border-b border-gray-200 px-2 py-1.5 text-left font-semibold text-gray-700">Issue</th>
              <th class="border-b border-gray-200 px-2 py-1.5 text-center font-semibold text-gray-700 w-24">MTR</th>
              <th class="border-b border-gray-200 px-2 py-1.5 text-center font-semibold text-gray-700 col-tp">TP</th>
              <th class="border-b border-gray-200 px-2 py-1.5 text-center font-semibold text-gray-700 col-layer">Layer</th>
              <th class="border-b border-gray-200 px-2 py-1.5 text-center font-semibold text-gray-700 w-10"></th>
            </tr>
          </thead>
          <tbody id="issueTable" class="divide-y divide-gray-200"></tbody>
        </table>
      </div>
    </div>

    <div class="glass-effect rounded-lg p-3 shadow-xl h-fit">
      <h2 class="text-sm font-bold text-gray-800 mb-2 flex items-center gap-1">
        <svg class="w-4 h-4 text-indigo-600" fill="currentColor" viewBox="0 0 20 20"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zm0 8a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zm8-8a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2h-2zm0 8a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2z"/></svg>
        Page Meta
      </h2>
      <div class="space-y-2">
        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-2">
          <p class="text-xs text-gray-600 font-medium mb-0.5">PAGES</p>
          <p class="text-xs font-bold text-indigo-600">30 | 32 | 34 | 36</p>
        </div>
        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-2">
          <p class="text-xs text-gray-600 font-medium mb-0.5">P VALUE</p>
          <p class="text-xs font-bold text-gray-800">54½ <span class="text-xs text-gray-600">≈ 53</span></p>
        </div>
      </div>
    </div>
  </div>

  <div class="glass-effect rounded-lg p-3 shadow-xl">
    <h2 class="text-sm font-bold text-gray-800 mb-2 flex items-center gap-1">
      <svg class="w-4 h-4 text-indigo-600" fill="currentColor" viewBox="0 0 20 20"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/></svg>
      Page Calculations (Size Config * Layer)
    </h2>
    <div class="overflow-x-auto rounded-lg border border-gray-200">
      <table class="w-full text-xs">
        <thead id="calcHead" class="bg-gradient-to-r from-indigo-50 to-purple-50"></thead>
        <tbody id="calcBody" class="divide-y divide-gray-200"></tbody>
        <tfoot class="bg-gradient-to-r from-gray-50 to-gray-100 border-t-2 border-gray-300">
          <tr id="calcFooter"></tr>
        </tfoot>
      </table>
    </div>
  </div>

</div>

<script>
/* ================= SIZE CONFIGURATION ================= */
const sizeConfig = {};
const sizeInputsContainer = document.getElementById("sizeInputs");

for (let size = 28; size <= 44; size += 2) {
  sizeConfig[size] = 1; 
  const div = document.createElement("div");
  div.className = "bg-gradient-to-r from-indigo-200 to-purple-50 rounded-lg p-2";
  div.innerHTML = `
    <label class="text-xs font-bold text-gray-700 block mb-1">${size}</label>
    <input type="number" min="0" value="1"
      class="w-full text-center border border-gray-300 rounded px-2 py-1 text-xs bg-white focus:ring-2 focus:ring-indigo-300"
      oninput="sizeConfig[${size}] = Number(this.value) || 0; renderCalc();">
  `;
  sizeInputsContainer.appendChild(div);
}

/* ================= ISSUE LOGIC ================= */
let issues = [
  { issue: "ISS01", mtr: 88.5, tp: [2], layer: [4] }
];

function addIssue() {
  // Find highest TP globally to suggest next
  let maxTP = 0;
  issues.forEach(iss => iss.tp.forEach(t => { if(t > maxTP) maxTP = t; }));
  
  issues.push({
    issue: `ISS0${issues.length + 1}`,
    mtr: 0,
    tp: [maxTP + 1],
    layer: [1]
  });
  renderIssues();
}

function removeIssue(idx) {
  if (issues.length > 1) {
    issues.splice(idx, 1);
    renderIssues();
  }
}

function renderIssues() {
  const issueTable = document.getElementById("issueTable");
  issueTable.innerHTML = "";
  issues.forEach((r, i) => {
    const row = document.createElement("tr");
    row.className = "hover:bg-indigo-50/50 transition-colors";
    row.innerHTML = `
        <td class="border-r border-gray-200 px-2 py-2 vertical-align-top">
          <input class="w-full text-center border border-gray-300 rounded px-1 py-1 text-xs font-medium bg-white"
            value="${r.issue}" oninput="issues[${i}].issue=this.value">
        </td>
        <td class="border-r border-gray-200 px-2 py-2">
          <input type="number" class="w-full text-center border border-gray-300 rounded px-1 py-1 text-xs bg-white"
            value="${r.mtr}" oninput="issues[${i}].mtr=Number(this.value)||0; renderCalc();">
        </td>
        <td class="border-r border-gray-200 px-2 py-2 col-tp">
          <div class="space-y-1" id="tp-container-${i}"></div>
          <button class="mt-1 w-full py-1 bg-indigo-500 text-white text-[10px] rounded font-bold" onclick="addTP(${i})">+ TP</button>
        </td>
        <td class="border-r border-gray-200 px-2 py-2 col-layer">
          <div class="space-y-1" id="layer-container-${i}"></div>
        </td>
        <td class="px-2 py-2 text-center">
          <button onclick="removeIssue(${i})" class="text-red-400 hover:text-red-600">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
          </button>
        </td>
    `;
    issueTable.appendChild(row);

    document.getElementById(`tp-container-${i}`).innerHTML = r.tp.map((tpVal, tpIdx) => `
      <div class="flex gap-1 items-center">
        <input type="number" class="w-full text-center border border-gray-300 rounded text-xs p-1"
          value="${tpVal}" oninput="issues[${i}].tp[${tpIdx}]=Number(this.value)||0; renderCalc();">
        <button class="text-red-500 text-xs px-1" onclick="removeTP(${i}, ${tpIdx})">×</button>
      </div>
    `).join("");

    document.getElementById(`layer-container-${i}`).innerHTML = r.layer.map((layerVal, layerIdx) => `
      <div class="h-[26px] flex items-center">
        <input type="number" class="w-full text-center border border-gray-300 rounded text-xs p-1"
          value="${layerVal}" oninput="issues[${i}].layer[${layerIdx}]=Number(this.value)||0; renderCalc();">
      </div>
    `).join("");
  });
  renderCalc();
}

function addTP(issueIdx) {
  const currentTPs = issues[issueIdx].tp;
  const currentLayers = issues[issueIdx].layer;
  const lastTP = currentTPs[currentTPs.length - 1];
  const lastLayer = currentLayers[currentLayers.length - 1];
  
  issues[issueIdx].tp.push(lastTP + 1);
  issues[issueIdx].layer.push(lastLayer); // Keeps previous layer value
  renderIssues();
}

function removeTP(issueIdx, tpIdx) {
  if (issues[issueIdx].tp.length > 1) {
    issues[issueIdx].tp.splice(tpIdx, 1);
    issues[issueIdx].layer.splice(tpIdx, 1);
    renderIssues();
  }
}

/* ================= CALCULATION ================= */
function renderCalc() {
  const body = document.getElementById("calcBody");
  const footerTr = document.getElementById("calcFooter");
  const thead = document.getElementById("calcHead");
  
  body.innerHTML = "";
  thead.innerHTML = "";

  const sizes = [];
  for (let s = 28; s <= 44; s += 2) sizes.push(s);

  let headHtml = `<th class="border-b border-gray-200 px-2 py-1.5 text-center font-semibold text-gray-700">Page (TP)</th>`;
  sizes.forEach(s => { headHtml += `<th class="border-b border-gray-200 px-2 py-1.5 text-center font-semibold text-gray-700">${s}</th>`; });
  headHtml += `<th class="border-b border-gray-200 px-2 py-1.5 text-center font-semibold text-indigo-600 bg-indigo-50">Total</th>`;
  thead.innerHTML = headHtml;

  const columnTotals = {};
  sizes.forEach(s => columnTotals[s] = 0);
  let grandTotal = 0;

  issues.forEach(issue => {
    issue.tp.forEach((tpValue, idx) => {
      let rowTotal = 0;
      const tr = document.createElement("tr");
      tr.className = "hover:bg-indigo-50/50 transition-colors";
      tr.innerHTML = `<td class="border-r border-gray-200 px-2 py-1 font-semibold text-gray-700 text-xs text-center">TP ${tpValue}</td>`;

      sizes.forEach(s => {
        const val = (sizeConfig[s] || 0) * (issue.layer[idx] || 0);
        rowTotal += val;
        columnTotals[s] += val;
        tr.innerHTML += `<td class="border-r border-gray-200 px-2 py-1 text-center text-xs text-gray-600">${val}</td>`;
      });

      grandTotal += rowTotal;
      tr.innerHTML += `<td class="px-2 py-1 text-center font-bold text-indigo-600 bg-indigo-50 text-xs">${rowTotal}</td>`;
      body.appendChild(tr);
    });
  });

  footerTr.innerHTML = `
    <td class="border-r border-gray-200 px-2 py-1 font-bold text-gray-700 text-xs text-center">Total</td>
    ${sizes.map(s => `<td class="border-r border-gray-200 px-2 py-1 text-center font-bold text-indigo-600 text-xs">${columnTotals[s]}</td>`).join("")}
    <td class="px-2 py-1 text-center font-bold text-sm text-indigo-600">${grandTotal}</td>
  `;
}

renderIssues();
</script>

</body>
</html>
